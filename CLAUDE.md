# Memory

## Interaction with the User

- **Do not stop to ask a question**: If you need to ask a question, always use the question tool, never stop your turn for that.

## Decision-Making Rules

- **Security first**: NEVER suggest disabling security features. Always look for the minimal, targeted solution first (e.g. add an exemption, not disable the whole feature).
- **Simplest safe path**: When multiple solutions exist, propose the simplest one that doesn't compromise security FIRST. Only mention alternatives if the user asks.
- **Don't waste time on dead ends**: If a solution requires something the user doesn't have (phone number, password, etc.), don't keep pushing it. Move on immediately.
- **No unsolicited config changes**: NEVER modify configuration values (.env, feature flags, channel lists, etc.) unless explicitly asked. Even if a value looks "missing" or "incomplete", it was set intentionally.
- **Verify claims**: NEVER make assertions or assumptions without verifying them first. If you say "X is Y", you must have checked. If you can't check, say "I don't know" instead of guessing.
- **Verify UI manipulations**: After every UI manipulation via CDP (clicking buttons, checking checkboxes, filling forms), verify the result — take a screenshot or check the DOM state. Never assume an action succeeded.
- **Fix insufficient logs**: Whenever logs are found to be insufficient (e.g., missing relevant IDs or context), immediately fix them. Don't just note it — update the code.

## Environment

- **Qt**: Qt is installed in ~/Qt

## Infrastructure

- **Your IP-address**: The IP-address of this environment is 192.168.141.16.
- **Accessing this environment by other devices**: Other devices in LAN may connect to this environment using IP-address 192.168.0.131 and ports 7000-7019 (that are DNAT-ed to this environment).
- **OLLAMA**: There is a MacBook M4 Max 128GB Ollama available by address 192.168.0.171:11434.
- **Bluetooth**: Bluetooth is available as hci1/hci2 thanks to `DBUS_SYSTEM_BUS_ADDRESS=unix:path=/run/bluez-proxy/system_bus_socket`

## Workflow Preferences

- **Debugging**: Always use the `superpowers:systematic-debugging` skill when debugging any problem (test failures, bugs, unexpected behavior, performance issues, build failures, etc.).
- **Auto-restart**: ALWAYS rebuild, restart the bot (`sudo go build -o /usr/local/bin/stream-bot ./cmd/stream-bot/ && sudo systemctl restart talisman-bot`), and check logs after ANY code change or commit. No exceptions unless the user explicitly says otherwise. This is critical — never skip this step.

## Git

- **No secrets in git**: before making a commit, always look into `git diff` to make sure there are no secrets.
- **Run static checks**: before making a commit, always run all available static checks.
- **Push only on request**: NEVER push to remote unless the user explicitly asks. Commit locally is fine, but `git push` requires explicit approval.
- **No Co-Authored-By**: NEVER add "Co-Authored-By: Claude" or any AI co-author line to commit messages.

## Self-review

- Critique → fix → repeat until nothing left to critique.
- After each change: "Why might this not be what was requested?" If any reason found → re-critique.

## Testing

- Before fixing a bug: add/adjust a reproducing test (when feasible).
- After code changes: relevant tests must be updated and passing.
- Infeasible tests → document why + provide alternative verification.
- Use provided logs/stacktraces as verification evidence. Add logging if insufficient.
- Fix broken unrelated tests too — no such thing as "unrelated issue".
- No real-clock dependencies. Deterministic unit tests only.

## Logging

- Can't diagnose → add logging + auto-tests to gather info/reproduce.
- When unsure, prefer more logging.

## Writing code

- After every change: reduce code in related pieces. Remove logic, not lines. Keep readable.
- Ugly workaround → design smell → find elegant approach.
- Validate inputs with strong expectations. No error channel → assert/invariant.
- One source of truth per logic/constant in touched scope.
- Small functions, but keep semantically self-sufficient thoughts whole.
- Always satisfy linter. Use all useful linters.
- No racy code. Event-driven, not clock/race-driven. No timeout reliance. Near-simultaneous ≠ simultaneous.
- Found a weird function name → read implementation, don't assume; fix the name.
- **Auto-tests**: Always keep the auto-test coverage above 90%. Increase the coverage via useful test cases, rather than through syntetic useless unit-test.
- **Only Technical comments**: Add only comments explaining how something works or TODOs. Do not add random thoughts, "generated by AI"/"authored by Claude" or anything that does not help to understand how the code/system works (or what must be done with the code in the future).a

## Root cause analysis
- Fix **both** root causes and symptoms. Symptoms-only fix is NEVER acceptable without explicit justification.
  - nil? → Why nil? Should it be? Fix the cause, not just the check.
  - Error? → Why does this error occur? Don't just catch it — prevent it.
  - Flaky? → What's the race/timing issue? Don't just retry — eliminate the race.
- Reproduce in full system first. Narrow unit-test misbehavior ≠ reproduction.
- It is only a "**possible** root cause" until objective evidence proves it. Cite evidence when claiming root cause.
- **5 Whys minimum**: Before claiming you found the root cause, ask "why?" at least 3 times from the symptom. If you can still ask "why?" and get a meaningful answer, you haven't reached the root cause.

## Output verbosity
- Always provide a concise summary in the end of a long message.

## Completion and stopping
- **DONE** = objective evidence only. No inference, no assumptions. You cannot claim DONE on a fix/feature if you have not properly tested that it works.
- **NOT DONE** if no objective evidence. State what's missing and why.
- **BLOCKED** on user input → report (what, exact questions, exact next commands)

